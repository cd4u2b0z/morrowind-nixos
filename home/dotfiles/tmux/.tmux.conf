# ╔═══════════════════════════════════════════════════════════════════╗
# Source wallust-generated colors (dynamic theming)
# ║  TMUX CONFIGURATION - Nord Theme + Neovim Style                   ║
# ║  Matching lualine aesthetic with powerline separators             ║
# ╚═══════════════════════════════════════════════════════════════════╝

# ═══════════════════════════════════════════════════════════════════
#  GENERAL SETTINGS
# ═══════════════════════════════════════════════════════════════════

# Change prefix from Ctrl-b to Ctrl-a (easier to reach)
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# Enable mouse support (like Neovim mouse = "a")
set -g mouse on

# Start windows and panes at 1, not 0 (matches Neovim number = true)
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Increase scrollback buffer size
set -g history-limit 50000

# Enable true colors (matches Neovim termguicolors = true)
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",*256col*:Tc"
set -ga terminal-overrides ",xterm-256color:Tc"
set -ga terminal-overrides ",alacritty:Tc"

# ═══════════════════════════════════════════════════════════════════
#  KEY BINDINGS (Vim-style like Neovim keymaps)
# ═══════════════════════════════════════════════════════════════════

# Reload config file
bind r source-file ~/.tmux.conf \; display-message " Config reloaded!"

# Split panes using | and - (more intuitive)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind \\ split-window -h -c "#{pane_current_path}"
bind _ split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# Vim-style pane navigation (matches Neovim <C-h/j/k/l>)
bind -n C-h select-pane -L
bind -n C-j select-pane -D
bind -n C-k select-pane -U
bind -n C-l select-pane -R

# Fallback with prefix for nested sessions
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Resize panes with Vim keys (like Neovim <C-Arrow>)
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Create new window in current path
bind c new-window -c "#{pane_current_path}"

# Window navigation (like Neovim buffer switching)
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9

# Previous/Next window (like Neovim <S-h> / <S-l> for buffers)
bind -n S-Left previous-window
bind -n S-Right next-window

# Copy mode with Vim bindings (like Neovim clipboard = "unnamedplus")
setw -g mode-keys vi
bind v copy-mode
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "wl-copy"
bind -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "wl-copy"
bind p paste-buffer
bind P choose-buffer

# Quick session/window management
bind S choose-session
bind W choose-window

# ═══════════════════════════════════════════════════════════════════
#  TES III: MORROWIND THEME — Ashlands & Dwemer
# ═══════════════════════════════════════════════════════════════════

# Morrowind Palette
mw_bg="#1C1410"       # Deep volcanic dark
mw_surface="#2A211A"  # Ashland stone
mw_rock="#3D3228"     # Volcanic rock
mw_ash="#6B5D4F"      # Ash dust
mw_scroll="#8E7C6A"   # Weathered scroll
mw_parch="#D4C4A8"    # Parchment
mw_light="#E8DBC4"    # Light scroll
mw_bright="#F0E6D0"   # Bright parchment
mw_red="#A63D2F"      # Daedric crimson
mw_amber="#C47D3B"    # Silt strider amber
mw_gold="#D4A843"     # Dwemer gold
mw_green="#6A8F4D"    # Bitter Coast
mw_teal="#5B9E8F"     # Telvanni teal
mw_blue="#4E7BA8"     # Azura's blue
mw_violet="#8B5E8B"   # Soul gem violet
mw_brown="#7A4535"    # Red Mountain

# ─────────────────────────────────────────────────────────────────
# Status Bar — Dwemer Inscription Style with Powerline Separators
# ─────────────────────────────────────────────────────────────────
set -g status on
set -g status-position bottom
set -g status-justify left
set -g status-style "bg=#1C1410,fg=#D4C4A8"
set -g status-left-length 100
set -g status-right-length 100

# Left: Session name (Dwemer gold accent)
set -g status-left "\
#[bg=#D4A843,fg=#1C1410,bold] #S \
#[bg=#2A211A,fg=#D4A843]\
#[bg=#2A211A,fg=#5B9E8F]  #(git -C #{pane_current_path} branch --show-current 2>/dev/null || echo 'none') \
#[bg=#1C1410,fg=#2A211A] "

# Right: Info sections (volcanic gradient)
set -g status-right "\
#[fg=#2A211A]#[bg=#2A211A,fg=#D4C4A8] #{?client_prefix,  PREFIX ,}\
#[fg=#6B5D4F]#[bg=#6B5D4F,fg=#D4C4A8]  %Y-%m-%d \
#[fg=#5B9E8F]#[bg=#5B9E8F,fg=#1C1410]  %H:%M \
#[fg=#D4A843]#[bg=#D4A843,fg=#1C1410,bold]  #H "

# ─────────────────────────────────────────────────────────────────
# Window Status — Clean tabs
# ─────────────────────────────────────────────────────────────────
# Inactive windows
set -g window-status-format "\
#[fg=#1C1410,bg=#2A211A]\
#[fg=#5B9E8F,bg=#2A211A] #I  #W \
#[fg=#2A211A,bg=#1C1410]"

# Active window (Dwemer gold highlight)
set -g window-status-current-format "\
#[fg=#1C1410,bg=#D4A843]\
#[fg=#1C1410,bg=#D4A843,bold] #I  #W \
#[fg=#D4A843,bg=#1C1410]"

set -g window-status-separator ""

# ─────────────────────────────────────────────────────────────────
# Pane Borders — Volcanic cracks
# ─────────────────────────────────────────────────────────────────
set -g pane-border-style "fg=#2A211A"
set -g pane-active-border-style "fg=#D4A843"
set -g pane-border-lines heavy

# Display pane numbers
set -g display-panes-colour "#6B5D4F"
set -g display-panes-active-colour "#D4A843"
set -g display-panes-time 2000

# ─────────────────────────────────────────────────────────────────
# Messages & Mode — Morrowind style
# ─────────────────────────────────────────────────────────────────
set -g message-style "bg=#2A211A,fg=#D4A843,bold"
set -g message-command-style "bg=#2A211A,fg=#D4A843"
set -g mode-style "bg=#3D3228,fg=#F0E6D0"

# Clock mode
set -g clock-mode-colour "#D4A843"
set -g clock-mode-style 24

# ═══════════════════════════════════════════════════════════════════
#  PERFORMANCE (Matching Neovim updatetime/timeoutlen)
# ═══════════════════════════════════════════════════════════════════

# Reduce delay for escape key (like Neovim timeoutlen = 300)
set -sg escape-time 10

# Update status bar every second
set -g status-interval 1

# Focus events for Neovim autoread
set -g focus-events on

# Aggressive resize for better multi-monitor
setw -g aggressive-resize on

# Set window notifications
setw -g monitor-activity on
set -g visual-activity off

# ═══════════════════════════════════════════════════════════════════
#  SMART PANE SWITCHING (vim-tmux-navigator integration)
# ═══════════════════════════════════════════════════════════════════
# Smart pane switching with awareness of Vim splits
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|l?n?vim?x?|fzf)(diff)?$'"
bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h'  'select-pane -L'
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j'  'select-pane -D'
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k'  'select-pane -U'
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l'  'select-pane -R'

# Clear screen with prefix C-l (since C-l is taken)
bind C-l send-keys 'C-l'

# Colors now managed by Stylix (NixOS declarative theming)
