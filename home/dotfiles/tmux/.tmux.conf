# ╔═══════════════════════════════════════════════════════════════════╗
# Source wallust-generated colors (dynamic theming)
# ║  TMUX CONFIGURATION - Nord Theme + Neovim Style                   ║
# ║  Matching lualine aesthetic with powerline separators             ║
# ╚═══════════════════════════════════════════════════════════════════╝

# ═══════════════════════════════════════════════════════════════════
#  GENERAL SETTINGS
# ═══════════════════════════════════════════════════════════════════

# Change prefix from Ctrl-b to Ctrl-a (easier to reach)
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# Enable mouse support (like Neovim mouse = "a")
set -g mouse on

# Start windows and panes at 1, not 0 (matches Neovim number = true)
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Increase scrollback buffer size
set -g history-limit 50000

# Enable true colors (matches Neovim termguicolors = true)
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",*256col*:Tc"
set -ga terminal-overrides ",xterm-256color:Tc"
set -ga terminal-overrides ",alacritty:Tc"

# ═══════════════════════════════════════════════════════════════════
#  KEY BINDINGS (Vim-style like Neovim keymaps)
# ═══════════════════════════════════════════════════════════════════

# Reload config file
bind r source-file ~/.tmux.conf \; display-message " Config reloaded!"

# Split panes using | and - (more intuitive)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
bind \\ split-window -h -c "#{pane_current_path}"
bind _ split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# Vim-style pane navigation (matches Neovim <C-h/j/k/l>)
bind -n C-h select-pane -L
bind -n C-j select-pane -D
bind -n C-k select-pane -U
bind -n C-l select-pane -R

# Fallback with prefix for nested sessions
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Resize panes with Vim keys (like Neovim <C-Arrow>)
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Create new window in current path
bind c new-window -c "#{pane_current_path}"

# Window navigation (like Neovim buffer switching)
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9

# Previous/Next window (like Neovim <S-h> / <S-l> for buffers)
bind -n S-Left previous-window
bind -n S-Right next-window

# Copy mode with Vim bindings (like Neovim clipboard = "unnamedplus")
setw -g mode-keys vi
bind v copy-mode
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "wl-copy"
bind -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "wl-copy"
bind p paste-buffer
bind P choose-buffer

# Quick session/window management
bind S choose-session
bind W choose-window

# ═══════════════════════════════════════════════════════════════════
#  NORD THEME - Matching Lualine/Waybar Aesthetic
# ═══════════════════════════════════════════════════════════════════

# Nord Palette
nord0="#2e3440"   # Polar Night - darkest
nord1="#3b4252"   # Polar Night
nord2="#434c5e"   # Polar Night
nord3="#4c566a"   # Polar Night - lightest
nord4="#d8dee9"   # Snow Storm
nord5="#e5e9f0"   # Snow Storm
nord6="#eceff4"   # Snow Storm - brightest
nord7="#8fbcbb"   # Frost - teal
nord8="#88c0d0"   # Frost - light blue (primary accent)
nord9="#81a1c1"   # Frost - blue
nord10="#5e81ac"  # Frost - dark blue
nord11="#bf616a"  # Aurora - red
nord12="#d08770"  # Aurora - orange
nord13="#ebcb8b"  # Aurora - yellow
nord14="#a3be8c"  # Aurora - green
nord15="#b48ead"  # Aurora - purple

# ─────────────────────────────────────────────────────────────────
# Status Bar - Lualine Style with Powerline Separators
# ─────────────────────────────────────────────────────────────────
set -g status on
set -g status-position bottom
set -g status-justify left
set -g status-style "bg=#2e3440,fg=#d8dee9"
set -g status-left-length 100
set -g status-right-length 100

# Left: Session name (like lualine_a mode section)
set -g status-left "\
#[bg=#88c0d0,fg=#2e3440,bold] #S \
#[bg=#3b4252,fg=#88c0d0]\
#[bg=#3b4252,fg=#81a1c1]  #(git -C #{pane_current_path} branch --show-current 2>/dev/null || echo 'none') \
#[bg=#2e3440,fg=#3b4252] "

# Right: Info sections (like lualine_x, y, z)
set -g status-right "\
#[fg=#3b4252]#[bg=#3b4252,fg=#d8dee9] #{?client_prefix,  PREFIX ,}\
#[fg=#4c566a]#[bg=#4c566a,fg=#d8dee9]  %Y-%m-%d \
#[fg=#81a1c1]#[bg=#81a1c1,fg=#2e3440]  %H:%M \
#[fg=#88c0d0]#[bg=#88c0d0,fg=#2e3440,bold]  #H "

# ─────────────────────────────────────────────────────────────────
# Window Status - Clean tabs like Lualine bufferline
# ─────────────────────────────────────────────────────────────────
# Inactive windows
set -g window-status-format "\
#[fg=#2e3440,bg=#3b4252]\
#[fg=#81a1c1,bg=#3b4252] #I  #W \
#[fg=#3b4252,bg=#2e3440]"

# Active window (highlighted like lualine current buffer)
set -g window-status-current-format "\
#[fg=#2e3440,bg=#88c0d0]\
#[fg=#2e3440,bg=#88c0d0,bold] #I  #W \
#[fg=#88c0d0,bg=#2e3440]"

set -g window-status-separator ""

# ─────────────────────────────────────────────────────────────────
# Pane Borders - Subtle like Neovim splits
# ─────────────────────────────────────────────────────────────────
set -g pane-border-style "fg=#3b4252"
set -g pane-active-border-style "fg=#88c0d0"
set -g pane-border-lines heavy

# Display pane numbers
set -g display-panes-colour "#4c566a"
set -g display-panes-active-colour "#88c0d0"
set -g display-panes-time 2000

# ─────────────────────────────────────────────────────────────────
# Messages & Mode - Matching Neovim popup style
# ─────────────────────────────────────────────────────────────────
set -g message-style "bg=#3b4252,fg=#88c0d0,bold"
set -g message-command-style "bg=#3b4252,fg=#88c0d0"
set -g mode-style "bg=#4c566a,fg=#eceff4"

# Clock mode
set -g clock-mode-colour "#88c0d0"
set -g clock-mode-style 24

# ═══════════════════════════════════════════════════════════════════
#  PERFORMANCE (Matching Neovim updatetime/timeoutlen)
# ═══════════════════════════════════════════════════════════════════

# Reduce delay for escape key (like Neovim timeoutlen = 300)
set -sg escape-time 10

# Update status bar every second
set -g status-interval 1

# Focus events for Neovim autoread
set -g focus-events on

# Aggressive resize for better multi-monitor
setw -g aggressive-resize on

# Set window notifications
setw -g monitor-activity on
set -g visual-activity off

# ═══════════════════════════════════════════════════════════════════
#  SMART PANE SWITCHING (vim-tmux-navigator integration)
# ═══════════════════════════════════════════════════════════════════
# Smart pane switching with awareness of Vim splits
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|l?n?vim?x?|fzf)(diff)?$'"
bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h'  'select-pane -L'
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j'  'select-pane -D'
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k'  'select-pane -U'
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l'  'select-pane -R'

# Clear screen with prefix C-l (since C-l is taken)
bind C-l send-keys 'C-l'

# Colors now managed by Stylix (NixOS declarative theming)
